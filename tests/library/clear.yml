- name: clear| account | info
  doboto_account:
  register: account_info

- name: cleare| account | verify
  assert:
    that:
      - "{{ account_info.account.uuid == 'b60c5d2212bf79e1a2bb0e3c1b2ae30a617fb796' }}"
    msg: "{{ account_info }}"

- name: clear | domains | list
  doboto_domain:
    action: list
  register: clear_domains

- name: clear | domains | destroy
  doboto_domain:
    action: destroy
    name: "{{ item.name }}"
  with_items: "{{ clear_domains.domains }}"
  ignore_errors: yes

- name: clear | droplets | list
  doboto_droplet:
    action: list
  register: clear_droplets

- name: clear | droplets | destroy
  doboto_droplet:
    action: destroy
    id: "{{ item.id }}"
  with_items: "{{ clear_droplets.droplets }}"
  ignore_errors: yes

- name: clear | snapshots | list
  doboto_snapshot:
    action: list
  register: clear_snapshots

- name: clear | snapshots | destroy
  doboto_snapshot:
    action: destroy
    id: "{{ item.id }}"
  with_items: "{{ clear_snapshots.snapshots }}"
  ignore_errors: yes

- name: clear | volumes | list
  doboto_volume:
    action: list
  register: clear_volumes

- name: clear | volumes | destroy
  doboto_volume:
    action: destroy
    id: "{{ item.id }}"
  with_items: "{{ clear_volumes.volumes }}"
  ignore_errors: yes

- name: clear | images | list
  doboto_image:
    action: list
    private: true
  register: clear_images

- name: clear | images | convert
  doboto_image:
    action: convert
    id: "{{ item.id }}"
    wait: true
  with_items: "{{ clear_images|json_query(image_backup_query) }}"
  vars:
    image_backup_query: "images[?type=='backup']"
  ignore_errors: yes

- name: clear | images | destroy
  doboto_image:
    action: destroy
    id: "{{ item.id }}"
  with_items: "{{ clear_images.images }}"
  ignore_errors: yes

- name: clear | ssh keys | list
  doboto_ssh_key:
    action: list
  register: clear_ssh_keys

- name: clear | ssh keys | destory
  doboto_ssh_key:
    action: destroy
    id: "{{ item.id }}"
  with_items: "{{ clear_ssh_keys.ssh_keys }}"

- name: clear | ssh keys | files
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /tmp/id_doboto
    - /tmp/id_doboto.pub
    - /tmp/id_doboto_present
    - /tmp/id_doboto_present.pub

- name: clear | floating ips | list
  doboto_floating_ip:
    action: list
  register: clear_floating_ips

- name: clear | floating ips | destory
  doboto_floating_ip:
    action: destroy
    ip: "{{ item.ip }}"
  with_items: "{{ clear_floating_ips.floating_ips }}"

- name: clear | tags | list
  doboto_tag:
    action: list
  register: clear_tags

- name: clear | tags | destroy
  doboto_tag:
    action: destroy
    name: "{{ item.name }}"
  with_items: "{{ clear_tags.tags }}"
