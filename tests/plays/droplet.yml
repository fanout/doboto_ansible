- hosts: all
  connection: local
  vars:
     ansible_python_interpreter: "/usr/bin/python"
  gather_facts: false
  tasks:

  - name: provision instance
    doboto_droplet:
      token: "{{ lookup('env','DO_API_TOKEN') }}"
      action: create
      name: droplet-provision
      region: nyc3
      size: 1gb
      image: ubuntu-14-04-x64
      ssh_keys: b5:ac:19:1a:8b:ba:7e:8c:8d:5d:a8:0c:fe:9f:9d:9e
      tags: one
      wait: True
    register: droplet_provision

  - name: List result
    debug:
      var: droplet_provision

  - name: Display public IP address
    debug:
      msg: "{{droplet_provision|json_query(public_ipv4_query)}}"
    vars:
      public_ipv4_query: "droplet.networks.v4[?type=='public'].ip_address"

  - name: provision instances
    doboto_droplet:
      action: create
      names:
          - droplets-provision-01
          - droplets-provision-02
          - droplets-provision-03
      region: nyc3
      size: 1gb
      image: ubuntu-14-04-x64
      ssh_keys: b5:ac:19:1a:8b:ba:7e:8c:8d:5d:a8:0c:fe:9f:9d:9e
      tags: one
      wait: True
    register: droplets_provision

  - name: List result
    debug:
      var: droplets_provision

  - name: destroy instances
    doboto_droplet:
      action: destroy
      tag: one
    register: droplets_destroyed

  - name: List result
    debug:
      var: droplets_destroyed
